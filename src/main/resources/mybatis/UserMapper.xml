<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.cxy.mapper.UserMapper">
    <resultMap id="BaseResultMap" type="com.cxy.model.User">
        <result column="nick_name" property="nickName"/>
        <result column="real_name" property="realName"/>
        <result column="sex" property="sex"/>
        <result column="age" property="age"/>
        <result column="support" property="support"/>
        <result column="university" property="university"/>
        <result column="attention" property="attention"/>
        <result column="live_city" property="liveCity"/>
        <result column="phone_num" property="phoneNum"/>
        <result column="fans" property="fans"/>
        <result column="user_id" property="userId"/>
        <result column="pass_word" property="passWord"/>
    </resultMap>

    <insert id="saveUser" parameterType="com.cxy.model.User" useGeneratedKeys="true" keyProperty="id">
        insert into user
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="realName != null">
                real_name,
            </if>
            <if test="passWord != null">
                pass_word,
            </if>
            <if test="nickName != null">
                nick_name,
            </if>
            <if test="sex != null">
                sex,
            </if>
            <if test="age != null">
                age,
            </if>
            <if test="support != null">
                support,
            </if>
            <if test="university != null">
                university,
            </if>
            <if test="attention != null">
                attention,
            </if>
            <if test="liveCity != null">
                live_city,
            </if>
            <if test="fans != null">
                fans,
            </if>
            <if test="phoneNum != null">
                phone_num,
            </if>
            <if test="registerIp != null">
                register_ip,
            </if>
            <if test="createTime != null">
                create_time,
            </if>
            <if test="userId != null">
                user_id,
            </if>
        </trim>

        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="realName != null">
                #{realName},
            </if>
            <if test="passWord != null">
                #{passWord},
            </if>
            <if test="nickName != null">
                #{nickName},
            </if>
            <if test="sex != null">
                #{sex},
            </if>
            <if test="age != null">
                #{age},
            </if>
            <if test="support != null">
                #{support},
            </if>
            <if test="university != null">
                #{university},
            </if>
            <if test="attention != null">
                #{attention},
            </if>
            <if test="liveCity != null">
                #{liveCity},
            </if>
            <if test="fans != null">
                #{fans},
            </if>
            <if test="phoneNum != null">
                #{phoneNum},
            </if>
            <if test="registerIp != null">
                #{registerIp},
            </if>
            <if test="createTime != null">
                #{createTime},
            </if>
            <if test="userId != null">
                #{userId},
            </if>
        </trim>
    </insert>

    <update id="updateUserInfo" parameterType="com.cxy.model.User">

        <foreach collection="list" item="item" index="index"
                 separator=";">
            UPDATE USER <set>
            <if test="item.realName != null and item.realName != ''">
                "real_name" = #{item.realName},
            </if>
            <if test="item.passWord != null and item.passWord != ''">
                "pass_word" = #{item.passWord},
            </if>
            <if test="item.nickName != null and item.nickName != ''">
                "nick_name" = #{item.nickName},
            </if>
            <if test="item.sex != null and item.sex != ''">
                "sex" = #{item.sex},
            </if>
            <if test="item.support != null and item.support != ''">
                "support" = #{item.support},
            </if>
            <if test="item.university != null and item.university != ''">
                "university" = #{item.university},
            </if>
            <if test="item.attention != null and item.attention != ''">
                "attention" = #{item.attention},
            </if>
            <if test="item.liveCity != null and item.liveCity != ''">
                "liveCity" = #{item.liveCity},
            </if>
            <if test="item.fans != null and item.fans != ''">
                "fans" = #{item.fans},
            </if>
            <if test="item.phoneNum != null and item.phoneNum != ''">
                "phoneNum" = #{item.phoneNum}
            </if>
        </set>
            <where>
                <if test="item.id != null and item.id != ''">
                    "id" = #{item.id}
                </if>
                <if test="item.userId != null and item.userId != ''">
                    "user_id" = #{item.userId}
                </if>
            </where>

        </foreach>
    </update>



    <select id="queryUser" resultMap="BaseResultMap" resultType="com.cxy.model.User" parameterType="map">
        SELECT * FROM user
        <include refid="selectSql" />
    </select>

    <sql id="selectSql">
        <where>
            <if test="userId !=null and userId != ''" >
                user_id = #{userId}
            </if>
            <if test="phoneNum !=null and phoneNum != ''" >
                phone_num = #{phoneNum}
            </if>
        </where>

    </sql>

    <select id="queryUserByUserId" resultMap="BaseResultMap" parameterType="Long">
        SELECT * FROM user WHERE user_id = #{userId}
    </select>

    <select id="queryLastUserId" resultType="Long">
        SELECT user_id FROM user ORDER BY id DESC limit 1
    </select>



</mapper>